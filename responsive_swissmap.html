<!DOCTYPE html>

<meta charset="utf-8">

<style>

.canton {
  fill: #bbb;
}

.canton-boundary {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
}
#container {
  margin:10px 10%;
  border:2px solid #000;
  border-radius: 5px;
  height:100%;
  overflow:hidden;
  background: #F0F8FF;
}

</style>

<body>

  <div id="container"></div>

<script src="js/d3.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script>

d3.select(window).on("resize", throttle);

var width = document.getElementById('container').offsetWidth;
var height = width / 2;

var topo, projection, path, svg, g;

var tooltip = d3.select("#container").append("div").attr("class", "tooltip hidden");

setup(width,height);

function setup(width,height){
  projection = d3.geo.albers()
    .rotate([0, 0])
    .center([8.3, 46.8])
    .translate([(width/2), (height/2)])
    .scale( width / 2 / Math.PI);

var path = d3.geo.path()
    .projection(projection);

  path = d3.geo.path().projection(projection);

  svg = d3.select("#container").append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g");

  g = svg.append("g");

}

d3.json("data/ch-cantons.json", function(error, swiss) {

  var topo = topojson.feature(swiss, swiss.objects.cantons).features;
  var boundary = topojson.mesh(swiss, swiss.objects.cantons, function(a, b) { return a !== b; });
  
  draw(topo, boundary);

});


function draw(topo, boundary) {

  g.append("g")
    .selectAll("path")
    .data(topo)
    .enter()
    .append("path")
    .attr("d", path)
    .attr("class", "canton")
    .attr("name", function(d,i) { return d.properties.name; })
    .attr("id", function(d,i) { return d.properties.abbr; });


  g.append("path")
      .datum(boundary)
      .attr("class", "canton-boundary")
      .attr("d", path);

}


function redraw() {
  width = document.getElementById('container').offsetWidth;
  height = width / 2;
  d3.select('svg').remove();
  setup(width,height);
  draw(topo);
}

var throttleTimer;
function throttle() {
  window.clearTimeout(throttleTimer);
    throttleTimer = window.setTimeout(function() {
      redraw();
    }, 200);
}

</script>
</body>
</html>
